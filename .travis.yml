dist: bionic
language: go
go:
- 1.13.x
- master
- tip
os:
- linux
- osx
env: MOD=github.com/romnnn/openhpibadge/cmd/openhpibadge BINARY=openhpibadge
jobs:
  allow_failures:
  - go: tip
  fast_finish: true
  include:
  - stage: deploy
    name: Publish release
    os: linux
    go: master
    script:
    - invoke cc
    deploy:
      provider: releases
      token:
        secure: ioHExBpzxkM0GmwlQ+G7+rvkzlPudYnF3W/nJe6wOeRe1qaAfyXzH4dPY85QoChLPlCoFNVVUCEjcKlz7xwVziHXh2eWS1K5P4If7LogbV5yOSugwKCSPHMhVyBCa1YIqct/T8NmcC1lqZsd+m+7fgLkMh+TYYPu4XdxdMEQaio0fnH6yOoBk6rE8NrhIoDe/HcaY1DitR0Zma1fch4Q7Gjp+S2HrLd9W8hohjNQ8dHEwh2RZEFS0NPApNrPfwEy5W7BYCz+6gb4+dXEtmmol101zqiEw5YFVHBsNuPzDLliueKWyO1vF/woqcozWk1W6W4g04Bl2axeVFTO09wC96EwuA6V+sjMWOpYO0RkCL2JDY8o3r2JHS3BTD1tNM8yHDtW+sksurlmOhs+jiA6k+1ZS+pITVehx5TXqY4Wozqo45pgFC0Sir0xyPPiVJHzL83KvYo+LMdpHXiFTMZ5BCxGq8rxVydeTBLXuPhIz+ZnTmHbfQe84k2snELsA9gRt7mFg+ujt6BHmhyA8dbCT4W2m1O9nzYaG+wXq6ZIOimmjFJzPi7SiYVKVjoqCaXSzcLLdvs2IUuRg0Jng8vcpPaFEWasCUXQc9wq2wqmakRByVqAfkI25LDK0MvI/JuvrEfwRaRX38r43B58ieZYlzB9mQQ+5JWQ0gtlnKl8uB4=
      file_glob: true
      file: build/*
      skip_cleanup: true
      on:
        repo: romnnn/openhpibadge
        tags: true
install: true
notifications:
  email: false
before_script:
- pip install -U pip && pip install pre-commit invoke ruamel.yaml
- go get -u golang.org/x/lint/golint
- go get github.com/fzipp/gocyclo
- go get github.com/mitchellh/gox
script:
- env GO111MODULE=on go build ${MOD}
- invoke pre-commit
- env GO111MODULE=on go test -v -race -coverprofile=coverage.txt -coverpkg=all -covermode=atomic
  ./...
after_success:
- bash <(curl -s https://codecov.io/bash)
